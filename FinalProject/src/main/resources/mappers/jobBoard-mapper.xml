<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="test_mapper">
	
	<resultMap type="JobBoard" id="jobBoardMap">
		<result column="nickName" property="nickName"/>
		<result column="writeDate" property="writeDate"/>
		<result column="jobtype" property="jobType"/>
		<result column="saltype" property="salType"/>
		<result column="status" property="status"/>
	</resultMap>
	
	<select id="selectJobBoardList" resultMap="jobBoardMap">
		<!-- 게시판  + 구인구직테이블 조회 -->
		SELECT NO, TITLE, NICKNAME, WRITEDATE, STARTDATE, ENDDATE, 
				STARTJOB, ENDJOB, SALARY, CD1.VALUE "JOBTYPE", CD2.VALUE "SALTYPE", VIEWCOUNT, CD3.VALUE "STATUS"
		FROM DC_BOARD_JOB_TB JB
		JOIN DC_BOARD_TB B ON(B.NO = JB.BOARDNO)
		JOIN DC_MEMBER_TB M ON(M.NO = B.MEMBERNO)
		JOIN DC_CODE_TB CD1 ON(CD1.ID = JB.SALTYPE)
		JOIN DC_CODE_TB CD2 ON(CD2.ID = JB.JOBTYPE)
		JOIN DC_CODE_TB CD3 ON(CD3.ID = B.STATUS)
	</select>
	
	<select id="selectJobBoardTotalContents" resultType="_int">
		SELECT COUNT(*) FROM DC_BOARD_JOB_TB
	</select>
	
	<select id="selectOneJobBoard" parameterType="_int" resultType="JobBoard">
		<!-- 게시물 상세조회 -->
		SELECT NO, TITLE, NICKNAME, CONTENT, WRITEDATE, STARTDATE, ENDDATE, 
				STARTJOB, ENDJOB, SALARY, CD1.VALUE  "JOBTYPE", CD2.VALUE "SALTYPE", VIEWCOUNT, STATUS, CD3.VALUE "STATUS"
		FROM DC_BOARD_JOB_TB JB
		JOIN DC_BOARD_TB B ON(B.NO = JB.BOARDNO)
		JOIN DC_MEMBER_TB M ON(M.NO = B.MEMBERNO)
		JOIN DC_CODE_TB CD1 ON(CD1.ID = JB.SALTYPE)
		JOIN DC_CODE_TB CD2 ON(CD2.ID = JB.JOBTYPE)
		JOIN DC_CODE_TB CD3 ON(CD3.ID = B.STATUS)
		WHERE B.NO = #{no}
	</select>
	
	<select id="endJobDday" resultType="_int">
	<!-- 마감 D-DAY -->
		SELECT FLOOR(ENDDATE - SYSDATE)
		FROM DC_BOARD_JOB_TB
		WHERE BOARDNO = #{boardNo}
	</select>
	
	<select id="workTime" resultType="int">
		<!-- 근무시간 -->
		SELECT SUBSTR(ENDTIME, 1, 2) - SUBSTR(STARTTIME, 1, 2) HOUR, 
				SUBSTR(ENDTIME, 4, 2) - SUBSTR(STARTTIME, 4, 2) MIN
		FROM DC_BOARD_JOB_TB
		WHERE BOARDNO = #{no}
	</select>
	
	<insert id="insertJobBoard">
		<!--
		BOARD 추가
	 	게시글번호 / 게시글제목 / 작성 / 게시글내용 / 조회수 / 게시판유형 / 게시글상태 / 회원번호 / 자유게시판 카테고리 
		-->
		INSERT INTO DC_BOARD_TB VALUES(
			SEQ_MEMBER.NEXTVAL, #{title}, #{writeDate}, #{content}, 0, 1, 1, #{memberNo}, NULL
		)
		<!-- 
			BOARD 구인구직테이블 추가
			구인구직게시글번호 / 구인구직구분 / 급여 / 
			게시글 시작일 / 게시글 마감일 / 근무 시작일 / 근무 종료일 /
			근무시작시간 / 근무종료시간 / 근무장소 / 게시글번호 /
			업체번호 / 고용타입 / 봉급타입 / 구인구직상태
		 -->
	 	INSERT INTO DC_BOARD_JOB_TB VALUES(
	 		{no}, #{type}, #{salary}, 
	 		#{startDate}, #{endDate}, #{startJob}, #{endJob},
	 		#{startTime}, #{endTime}, #{location}, #{boardNo},
	 		#{companyNo}, #{jobType}, #{salType}, #{status}
	 	)
	</insert>
	
	<update id="updateJobBoard" parameterType="JobBoard">
		
	</update>
	
	
</mapper>