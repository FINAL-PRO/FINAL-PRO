COMMENT ON COLUMN DC_BOARD_USED_TB.GOODSNAME IS '물품명';
COMMENT ON COLUMN DC_BOARD_GROUP_TB.ENDDATE IS '마감일';
COMMENT ON COLUMN DC_BOARD_GROUP_TB.GOODSNAME IS '물품명';

CREATE OR REPLACE VIEW DC_BOARD_GROUP_VIEW
AS
SELECT G.NO, G.BOARDNO, G.GOODSNAME, G.PRICE, G.ENDDATE, G.DEPOSIT,
    G.MAXCOUNT, G.CURRENTCOUNT, B.TITLE, B.CONTENT,
    (SELECT NAME FROM DC_GOODS_CATEGORY_TB GC WHERE GC.NO=G.GOODSNO)GOODSCATEGORY,
    (SELECT NICKNAME FROM DC_MEMBER_TB M WHERE M.NO=B.MEMBERNO) MEMBER,
    (SELECT VALUE FROM DC_CODE_TB C WHERE C.ID=G.STATUS) GSTATUS,
    (SELECT VALUE FROM DC_CODE_TB C WHERE C.ID=G.DEALTYPE) DEALTYPE,
    B.WRITEDATE,B.VIEWCOUNT, B.STATUS,
    (SELECT SUBSTR(BEF, 0, INSTR(BEF, '"')-1)
     FROM (SELECT NO, SUBSTR(CONTENT, INSTR(CONTENT, 'img src="')+9) BEF FROM DC_BOARD_TB)D
     WHERE D.NO=G.BOARDNO
    ) THUMBNAIL
FROM DC_BOARD_GROUP_TB G
JOIN DC_BOARD_TB B ON (G.BOARDNO=B.NO)
WITH READ ONLY;

commit;
    
-- 썸네일 쿼리
-- <p>공동구매 게시물</p><img src="aaa/bbb/ccc/ddd.jpg"/><p>내용입니다.</p>
-- --> aaa/bbb/ccc/ddd.jpg
SELECT SUBSTR(BEF, 0, INSTR(BEF, '"')-1) THUMBNAIL
FROM (SELECT SUBSTR(CONTENT, INSTR(CONTENT, 'img src="')+9) BEF
FROM DC_BOARD_TB);

