-- 광고테이블 컬럼 추가
ALTER TABLE DC_AD_TB ADD (LANDINGPAGE VARCHAR2(100));

-- 공동구매 트리거 추가
CREATE OR REPLACE TRIGGER GROUP_HISTORY_TRG1
AFTER INSERT ON DC_GROUP_HISTORY_TB
DECLARE
    CUR_GROUPNO NUMBER;
    CUR_COUNT NUMBER;
    MAX_COUNT NUMBER;
BEGIN
    SELECT GROUPNO INTO CUR_GROUPNO 
    FROM (SELECT * FROM DC_GROUP_HISTORY_TB ORDER BY NO DESC) WHERE ROWNUM = 1;
    SELECT COUNT(*) INTO CUR_COUNT FROM DC_GROUP_HISTORY_TB WHERE GROUPNO = CUR_GROUPNO;
    SELECT MAXCOUNT INTO MAX_COUNT FROM DC_BOARD_GROUP_TB WHERE NO = CUR_GROUPNO;

    IF (CUR_COUNT = MAX_COUNT)
     THEN UPDATE DC_BOARD_GROUP_TB SET STATUS='GROUP002' WHERE NO = CUR_GROUPNO;
    END IF;
END;

-- 공동구매 테이블 수정
ALTER TABLE DC_BOARD_GROUP_TB ADD(BANK VARCHAR2(50));
COMMENT ON COLUMN DC_BOARD_GROUP_TB.BANK IS '사용자 은행';

ALTER TABLE DC_BOARD_GROUP_TB ADD CONSTRAINT FK_CODE_TO_GROUP_3 FOREIGN KEY (
   BANK
)
REFERENCES DC_CODE_TB (
   ID
);
COMMIT;